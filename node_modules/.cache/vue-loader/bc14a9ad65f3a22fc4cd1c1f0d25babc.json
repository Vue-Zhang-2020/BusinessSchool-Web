{"remainingRequest":"D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\src\\views\\business_port\\teaching\\teaching_plan\\teaching_enact_plan.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\src\\views\\business_port\\teaching\\teaching_plan\\teaching_enact_plan.vue","mtime":1594612519731},{"path":"D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nexport default {\r\n  name: '',\r\n  data () {\r\n    return {\r\n      schoolId: 0,\r\n      skFirmDialog: false, // 上课企业 Dialog\r\n      skFirmSearch: '', // 上课企业 搜索内容\r\n      courseDialog: false, // 添加课程 Dialog\r\n      courseSearch: '', // 添加课程 搜索内容\r\n      examDialog: false, // 添加考试 Dialog\r\n      examSearch: '', // 添加考试 搜索内容\r\n      medalDialog: false, // 添加勋章 Dialog\r\n      medalSearch: '', // 添加勋章 搜索内容\r\n      firmJsonData: [], // 企业\r\n      medalJsonData: [], // 勋章\r\n      courseJsonData: [], // 课程\r\n      examJsonData: [], // 考试\r\n      studentJsonData: [],\r\n      clickMajor: '',\r\n      clickClasses: '',\r\n      studentInfoJsonData: [],\r\n      schoolSelectorJsonData: [],\r\n      insertObj: false,\r\n      formLabelWidth: '120px',\r\n      defaultProps: {\r\n        children: 'classinfo',\r\n        label: 'classname'\r\n      },\r\n      firmCheck: [],\r\n      courseCheck: [],\r\n      examCheck: [],\r\n      medalCheck: [],\r\n      stduentCheck: [],\r\n      teachingPlanForm: {\r\n        attendFirm: [], // 上课企业\r\n        teachingPlan: '',  // 请输入教学计划主题\r\n        teachingPlanCourse: [],  // 教学计划内容 - 课程\r\n        teachingPlanExam: [],  // 教学计划内容 - 考试\r\n        teachingPlanInfo: '', // 教学计划说明\r\n        imageUrl: '', // 教学计划封面\r\n        teachingPlanSchool: '', // 学校\r\n        teachingPlanObj: [], // 上课对象\r\n        teachingPlanMedal: [], // 认证勋章\r\n        teachingPlanComplete: '', // 完成度\r\n        teachingPlanIntegral: '', // 积分\r\n        teachingPlanGrade: '' // 成绩\r\n      },\r\n      rules: {\r\n        attendFirm: [\r\n          { required: true, message: '请选择上课企业', trigger: 'change' }\r\n        ],\r\n        teachingPlan: [\r\n          { required: true, message: '请输入教学计划主题', trigger: 'blur' }\r\n        ],\r\n        teachingPlanDesc: [\r\n          { required: true, message: '请选择教学计划内容', trigger: 'change' }\r\n        ],\r\n        teachingPlanSchool: [\r\n          { required: true, message: '请选择学校', trigger: 'change' }\r\n        ],\r\n        teachingPlanObj: [\r\n          { required: true, message: '请选择上课对象', trigger: 'change' }\r\n        ]\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.schoolId = this.$store.getters.schoolId\r\n    this.requestSchoolSelectorJsonData()\r\n  },\r\n  methods: {\r\n    // 获取学校列表\r\n    requestSchoolSelectorJsonData() {\r\n      this.$axios.post(this.$global.sApi + '/addscuser', JSON.stringify({\r\n        'type': 3,\r\n        'current_page': 1,\r\n        'perpage': 9999\r\n      })).then(res => {\r\n        this.schoolSelectorJsonData = res.data.data.data\r\n      })\r\n    },\r\n    // 显示企业选择\r\n    showFirmModal() {\r\n      this.requestFirmJsonData()\r\n      this.skFirmDialog = true\r\n    },\r\n    // 企业列表\r\n    requestFirmJsonData() {\r\n      this.$axios.post(this.$global.sApi + '/findmsg', JSON.stringify({\r\n        'type': 1\r\n      })).then(res => {\r\n        this.firmJsonData = res.data.data[0]\r\n      })\r\n    },\r\n    // 显示添加课程\r\n    showCourseModal() {\r\n      this.requestCourseJsonData()\r\n      this.courseDialog = true\r\n    },\r\n    // 获取课程列表\r\n    requestCourseJsonData() {\r\n      this.$axios.post(this.$global.sApi + '/course', JSON.stringify({\r\n        'type': 4,\r\n        'current_page': 1,\r\n        'perpage': 9999\r\n      })).then(res => {\r\n        this.courseJsonData = res.data.data.data\r\n      })\r\n    },\r\n    // 显示添加考试\r\n    showExamModal() {\r\n      this.requestExamJsonData()\r\n      this.examDialog = true\r\n    },\r\n    // 获取考试列表\r\n    requestExamJsonData() {\r\n      this.$axios.post(this.$global.sApi + '/addtest', JSON.stringify({\r\n        'type': 4,\r\n        'current_page': 1,\r\n        'perpage': 9999\r\n      })).then(res => {\r\n        this.examJsonData = res.data.data.data\r\n      })\r\n    },\r\n    // 显示添加对象\r\n    showObjModal() {\r\n      this.requestSchoolJsonData()\r\n      this.requestStudentInfoJsonData()\r\n      this.insertObj = true\r\n    },\r\n    // 筛选学生资料\r\n    requestFilterClickJsonData() {\r\n      this.$axios.post(this.$global.sApi + '/findstu', JSON.stringify({\r\n        'proinfoid': parseInt(this.clickMajor)|'',\r\n        'classinfoid': parseInt(this.clickClasses)|''\r\n      })).then(res => {\r\n        // this.total = res.data.data.total\r\n        const json = res.data.data[0]\r\n        this.studentInfoJsonData = json\r\n      })\r\n    },\r\n    // 获取学生资料列表\r\n    requestStudentInfoJsonData() {\r\n      this.$axios.post(this.$global.sApi + '/liststu', JSON.stringify({\r\n        'classinfoid': 2,\r\n        'majorId': '',\r\n        'classesId': '',\r\n        'current_page': this.currentPage,\r\n        'perpage': this.pagesize,\r\n      })).then(res => {\r\n        this.total = res.data.data.total\r\n        const json = res.data.data.data\r\n        if (json.length > 0) {\r\n          this.studentInfoJsonData = json\r\n        }\r\n      })\r\n    },\r\n    // 获取学校数据\r\n    requestSchoolJsonData() {\r\n      this.$axios.post(this.$global.sApi + '/navigation', JSON.stringify({\r\n        'scinfoid': this.schoolId\r\n      })).then(res => {\r\n        const json = res.data.data[0]\r\n        if (json.length > 0) {\r\n          this.studentJsonData = json\r\n        }\r\n      })\r\n    },\r\n    // 显示添加勋章\r\n    showMedalModal() {\r\n      this.requestMedalJsonData()\r\n      this.medalDialog = true\r\n    },\r\n    // 勋章列表\r\n    requestMedalJsonData() {\r\n      this.$axios.post(this.$global.sApi + '/addexz', JSON.stringify({\r\n        'type': 4,\r\n        'current_page': 1,\r\n        'perpage': 9999\r\n      })).then(res => {\r\n        this.medalJsonData = res.data.data.data\r\n      })\r\n    },\r\n    handleClose(tag) {\r\n      this.dynamicTags.splice(this.dynamicTags.indexOf(tag), 1);\r\n    },\r\n    // 前端校验文件上传是否符合条件\r\n    file_info_check (file) {\r\n      var ret = ''\r\n      if (file === undefined) {\r\n        ret = ''\r\n      }\r\n      // eslint-disable-next-line camelcase\r\n      var max_file_size = 2 * 1024 * 1024\r\n      // eslint-disable-next-line camelcase\r\n      if (file.size > max_file_size) {\r\n        ret = '文件不能大于2Mb'\r\n      }\r\n      var typeJpg = '.jpg'\r\n      var typeJpeg = '.jpeg'\r\n      var typePng = '.png'\r\n      if (file.name.indexOf(typeJpg) === -1) {\r\n        ret = '文件格式要求是.jpg/.jpeg/.png'\r\n      } else {\r\n        ret = 'success'\r\n        return ret\r\n      }\r\n      if (file.name.indexOf(typeJpeg) === -1) {\r\n        ret = '文件格式要求是.jpg/.jpeg/.png'\r\n      } else {\r\n        ret = 'success'\r\n        return ret\r\n      }\r\n      if (file.name.indexOf(typePng) === -1) {\r\n        ret = '文件格式要求是.jpg/.jpeg/.png'\r\n      } else {\r\n        ret = 'success'\r\n        return ret\r\n      }\r\n      return ret\r\n    },\r\n    uploadImg (fileObj) {\r\n      this.loading = true\r\n      let fileStatus = this.file_info_check(fileObj.file)\r\n      if (fileStatus === 'success') {\r\n        let formData = new FormData()\r\n        formData.append('file', fileObj.file)\r\n        this.$axios.post('/upschead', formData, {\r\n          headers: {\r\n            'Content-type': 'multipart/form-data'\r\n          }\r\n        }).then(res => {\r\n          // this.registerForm.imageUrl = res\r\n          this.$message({\r\n            message: '提交成功',\r\n            type: 'success'\r\n          })\r\n          this.teachingPlanForm.imageUrl = res.data.path\r\n          this.loading = false\r\n        })\r\n      } else {\r\n        this.$message({\r\n          message: fileStatus,\r\n          type: 'error'\r\n        })\r\n      }\r\n    },\r\n    handleSelectionFirm(val) {\r\n      this.firmCheck = val\r\n    },\r\n    checkFirm() {\r\n      this.teachingPlanForm.attendFirm = this.firmCheck\r\n      console.log(this.teachingPlanForm.attendFirm)\r\n      this.skFirmDialog = false\r\n    },\r\n    handleSelectionCourse(val) {\r\n      this.courseCheck = val\r\n    },\r\n    checkCourse() {\r\n      this.teachingPlanForm.teachingPlanCourse = this.courseCheck\r\n      this.courseDialog = false\r\n    },\r\n    handleSelectionExam(val) {\r\n      this.examCheck = val\r\n    },\r\n    checkExam() {\r\n      this.teachingPlanForm.teachingPlanExam = this.examCheck\r\n      this.examDialog = false\r\n    },\r\n    handleSelectionMedal(val) {\r\n      this.medalCheck = val\r\n    },\r\n    checkMedal() {\r\n      this.teachingPlanForm.teachingPlanMedal = this.medalCheck\r\n      this.medalDialog = false\r\n    },\r\n    handleSelectionStudent(val) {\r\n      this.stduentCheck = val\r\n    },\r\n    checkStudent() {\r\n      this.teachingPlanForm.teachingPlanObj = this.stduentCheck\r\n      this.insertObj = false\r\n    },\r\n    // 院校专业菜单\r\n    handleNodeClick(data) {\r\n      if (typeof data.classinfo === \"object\") {\r\n        this.clickMajor = data.id\r\n      } else {\r\n        this.clickClasses = data.id\r\n        this.requestFilterClickJsonData()\r\n      }\r\n    },\r\n    // 树形菜单\r\n    renderContent(h,{node,data,store}) {\r\n      let addElement = arguments[0];\r\n      return addElement('span',{class:\"folder-box\"},[\r\n        addElement('i',{class:\"folder-icon\"}),\r\n        addElement('span',\"    \"),\r\n        addElement('span',arguments[1].node.label)\r\n      ]);\r\n    },\r\n    // 提交\r\n    submitTeachingPlan(formName) {\r\n      this.$refs[formName].validate((valid) => {\r\n        if (valid) {\r\n          if (this.courseCheck.length > 0) {\r\n            this.insertTeachingPlan(formName)\r\n          } else {\r\n            this.$message({\r\n              message: '请选择教学计划内容',\r\n              type: 'warning'\r\n            })\r\n          }\r\n        } else {\r\n          return false;\r\n        }\r\n      });\r\n    },  \r\n    // 添加教学计划\r\n    insertTeachingPlan(formName) {\r\n      var firmList = ''\r\n      this.teachingPlanForm.attendFirm.forEach(element => {\r\n        firmList += element.id + ','\r\n      });\r\n      var courseList = ''\r\n      this.teachingPlanForm.teachingPlanCourse.forEach(element => {\r\n        courseList += element.id + ','\r\n      });\r\n      var examList = ''\r\n      this.teachingPlanForm.teachingPlanExam.forEach(element => {\r\n        examList += element.id + ','\r\n      });\r\n      var medalList = ''\r\n      this.teachingPlanForm.teachingPlanMedal.forEach(element => {\r\n        medalList += element.id + ','\r\n      });\r\n      this.$axios.post(this.$global.sApi + '/addevent', JSON.stringify({\r\n        // scinfoid::企业列表, 以逗号分隔                        teachingPlanForm: {\r\n        // major:主题                                attendFirm: [], // 上课企业\r\n        // course:课程列表ID 以逗号分隔               teachingPlan: '',  // 请输入教学计划主题\r\n        // test:考试列表id 以逗号分隔                 teachingPlanExam: [],  // 教学计划内容\r\n        // brief:简介 (空就以暂无代替)                teachingPlanInfo: '', // 教学计划说明\r\n        // header:封面图片 (空就以暂无代替)           imageUrl: '', // 教学计划封面\r\n        // schoolid:学校ID                           teachingPlanSchool: '', // 学校\r\n        // medal:认证勋章id 以逗号分隔                teachingPlanObj: '', // 上课对象\r\n        // points 积分完成率                         teachingPlanMedal: [], // 认证勋章\r\n        // res 成绩完成率                            teachingPlanComplete: '', // 完成度\r\n        // class 课程完成率                          teachingPlanIntegral: '', // 积分\r\n        // classid:班级id                           teachingPlanGrade: '' // 成绩\r\n        // classobj: 学生id 以逗号分隔               teachingPlanCourse: [],  // 教学计划内容\r\n\r\n        'scinfoid': firmList.substring(0, firmList.length - 1),\r\n        'major': this.teachingPlanForm.teachingPlan,\r\n        'course': courseList.substring(0, courseList.length - 1),\r\n        'test': examList.substring(0, examList.length - 1),\r\n        'brief': this.teachingPlanForm.teachingPlanInfo == '' ? '暂无' : this.teachingPlanForm.teachingPlanInfo,\r\n        'header': this.teachingPlanForm.imageUrl,\r\n        'schoolid': parseInt(this.teachingPlanForm.teachingPlanSchool),\r\n        'medal': medalList.substring(0, medalList.length - 1),\r\n        'points': this.teachingPlanForm.teachingPlanIntegral,\r\n        'res': this.teachingPlanForm.teachingPlanGrade,\r\n        'class': this.teachingPlanForm.teachingPlanComplete,\r\n        'classid': parseInt(this.clickClasses),\r\n        'classobj': this.teachingPlanForm.teachingPlan\r\n      })).then(res => {\r\n        this.$message({\r\n          message: '制定成功',\r\n          type: 'success'\r\n        })\r\n        this.$refs[formName].resetFields()\r\n        this.teachingPlanForm = {}\r\n        this.firmCheck = []\r\n        this.courseCheck = []\r\n        this.examCheck = []\r\n        this.medalCheck = []\r\n        this.stduentCheck = []\r\n        this.clickClasses = ''\r\n        this.clickMajor = ''\r\n      })\r\n    }\r\n  }\r\n}\r\n",null]}