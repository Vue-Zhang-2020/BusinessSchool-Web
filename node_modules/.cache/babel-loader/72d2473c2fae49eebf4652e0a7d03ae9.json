{"remainingRequest":"D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\node_modules\\babel-loader\\lib\\index.js!D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\src\\views\\school_port\\student\\student_info_manager.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\src\\views\\school_port\\student\\student_info_manager.vue","mtime":1594461008530},{"path":"D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\个人成长经历\\锐名科技\\产品开发\\商管院\\BusinessSchool-Web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\"use strict\";\n\nvar _interopRequireDefault = require(\"D:/\\u4E2A\\u4EBA\\u6210\\u957F\\u7ECF\\u5386/\\u9510\\u540D\\u79D1\\u6280/\\u4EA7\\u54C1\\u5F00\\u53D1/\\u5546\\u7BA1\\u9662/BusinessSchool-Web/node_modules/@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nrequire(\"core-js/modules/es6.function.name\");\n\nvar _typeof2 = _interopRequireDefault(require(\"D:/\\u4E2A\\u4EBA\\u6210\\u957F\\u7ECF\\u5386/\\u9510\\u540D\\u79D1\\u6280/\\u4EA7\\u54C1\\u5F00\\u53D1/\\u5546\\u7BA1\\u9662/BusinessSchool-Web/node_modules/@babel/runtime/helpers/typeof\"));\n\nvar _formatDate = require(\"../../../utils/formatDate\");\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nvar _default = {\n  name: 'info',\n  data: function data() {\n    return {\n      schoolId: 0,\n      // 学校Id\n      major: '',\n      // 专业\n      clickMajor: '',\n      classes: '',\n      // 班级\n      clickClasses: '',\n      deleteStudentId: '',\n      // 删除学生Id\n      insertOrModifyModel: 0,\n      // 0 添加 1 编辑\n      total: 0,\n      currentPage: 1,\n      pagesize: 5,\n      loading: false,\n      searchContent: '',\n      // 搜索内容\n      insertSingleStudentInfoDialog: false,\n      // 添加单个学生 Dailog\n      deleteStudentDialog: false,\n      // 删除Dialog\n      batchDialog: false,\n      formLabelWidth: '120px',\n      gradeOptions: [// 年级Json\n      {\n        id: '1',\n        grade: '一年级'\n      }, {\n        id: '2',\n        grade: '二年级'\n      }, {\n        id: '3',\n        grade: '三年级'\n      }, {\n        id: '4',\n        grade: '四年级'\n      }, {\n        id: '5',\n        grade: '五年级'\n      }],\n      birthday: '',\n      studentInfoForm: {\n        // 学生Form\n        id: '',\n        name: '',\n        major: '',\n        birthday: '',\n        grade: '',\n        classes: {},\n        photo: ''\n      },\n      rules: {\n        name: [{\n          required: true,\n          message: '请输入姓名',\n          trigger: 'blur'\n        }],\n        major: [{\n          required: true,\n          message: '请选择专业',\n          trigger: 'change'\n        }],\n        birthday: [{\n          type: 'date',\n          required: true,\n          message: '请选择出生年月',\n          trigger: 'change'\n        }],\n        grade: [{\n          required: true,\n          message: '请选择年级',\n          trigger: 'change'\n        }],\n        classes: [{\n          required: true,\n          message: '请选择班级',\n          trigger: 'change'\n        }],\n        photo: [{\n          required: true,\n          message: '请输入联系方式',\n          trigger: 'blur'\n        }]\n      },\n      majorOptions: [],\n      // 专业数据\n      classesOptions: [],\n      // 学校数据\n      studentInfoJsonData: [],\n      // 学生资料\n      studentJsonData: [],\n      // 学校数据\n      defaultProps: {\n        children: 'classinfo',\n        label: 'classname'\n      }\n    };\n  },\n  created: function created() {\n    this.schoolId = this.$store.getters.schoolId;\n    this.requestStudentInfoJsonData();\n    this.requestSchoolJsonData();\n    this.requestMajorJsonData();\n    this.requestClassesJsonData();\n  },\n  methods: {\n    handleSizeChange: function handleSizeChange(val) {\n      this.requestStudentInfoJsonData();\n    },\n    handleCurrentChange: function handleCurrentChange(val) {\n      this.requestStudentInfoJsonData();\n    },\n    // 添加学生资料\n    showInserModal: function showInserModal(index, row, flag) {\n      this.insertOrModifyModel = flag;\n\n      if (this.insertOrModifyModel === 1) {\n        this.studentInfoForm.id = row.id;\n        this.studentInfoForm.name = row.username;\n        this.studentInfoForm.major = row.proname;\n        this.studentInfoForm.birthday = this.stringToDate(row.age);\n        this.studentInfoForm.grade = row.live;\n        this.studentInfoForm.classes.proname = row.classname;\n        this.studentInfoForm.photo = row.phone;\n      }\n\n      this.insertSingleStudentInfoDialog = true;\n    },\n    // 时间格式化\n    stringToDate: function stringToDate(str) {\n      var year = str.substring(0, str.indexOf('年'));\n      var month = str.substring(str.indexOf('年') + 1, str.indexOf('月'));\n      var day = str.substring(str.indexOf('月') + 1, str.indexOf('日'));\n      var date = \"\".concat(year, \"-\").concat(month, \"-\").concat(day);\n      return new Date(date);\n    },\n    // 清空专业筛选\n    clearMajor: function clearMajor() {\n      this.major = '';\n      this.classesOptions = [];\n      this.classes = '';\n      this.requestStudentInfoJsonData();\n    },\n    // 清空班级筛选\n    clearClasses: function clearClasses() {\n      if (this.major != '') {\n        this.requestFilterJsonData();\n      } else {\n        this.requestStudentInfoJsonData();\n      }\n    },\n    // 批量录入学生资料\n    showBatchModal: function showBatchModal() {\n      this.batchDialog = true;\n    },\n    // 筛选条件查询\n    requestFilterJsonData: function requestFilterJsonData() {\n      var _this = this;\n\n      this.$axios.post(this.$global.sApi + '/findstu', JSON.stringify({\n        'proinfoid': parseInt(this.major) | '',\n        'classinfoid': parseInt(this.classes) | ''\n      })).then(function (res) {\n        // this.total = res.data.data.total\n        var json = res.data.data[0];\n\n        if (json.length > 0) {\n          _this.studentInfoJsonData = json;\n        }\n      });\n    },\n    requestFilterClickJsonData: function requestFilterClickJsonData() {\n      var _this2 = this;\n\n      this.$axios.post(this.$global.sApi + '/findstu', JSON.stringify({\n        'proinfoid': parseInt(this.clickMajor) | '',\n        'classinfoid': parseInt(this.clickClasses) | ''\n      })).then(function (res) {\n        // this.total = res.data.data.total\n        var json = res.data.data[0];\n\n        if (json.length > 0) {\n          _this2.studentInfoJsonData = json;\n        }\n      });\n    },\n    // 获取学生资料列表\n    requestStudentInfoJsonData: function requestStudentInfoJsonData() {\n      var _this3 = this;\n\n      this.$axios.post(this.$global.sApi + '/liststu', JSON.stringify({\n        'classinfoid': 2,\n        'majorId': this.major,\n        'classesId': this.classes,\n        'current_page': this.currentPage,\n        'perpage': this.pagesize\n      })).then(function (res) {\n        _this3.total = res.data.data.total;\n        var json = res.data.data.data;\n\n        if (json.length > 0) {\n          _this3.studentInfoJsonData = json;\n        }\n      });\n    },\n    // 获取学校数据\n    requestSchoolJsonData: function requestSchoolJsonData() {\n      var _this4 = this;\n\n      this.$axios.post(this.$global.sApi + '/navigation', JSON.stringify({\n        'scinfoid': this.schoolId\n      })).then(function (res) {\n        var json = res.data.data[0];\n\n        if (json.length > 0) {\n          _this4.studentJsonData = json;\n        }\n      });\n    },\n    // 获取专业列表\n    requestMajorJsonData: function requestMajorJsonData() {\n      var _this5 = this;\n\n      this.$axios.post(this.$global.sApi + '/prolistall', JSON.stringify({\n        'scinfoid': this.schoolId\n      })).then(function (res) {\n        var json = res.data.data[0];\n\n        if (json.length > 0) {\n          _this5.majorOptions = json;\n        }\n      });\n    },\n    // 获取班级列表\n    requestClassesJsonData: function requestClassesJsonData() {\n      var _this6 = this;\n\n      this.$axios.post(this.$global.sApi + '/findclass', JSON.stringify({\n        'proinfoid': parseInt(this.major)\n      })).then(function (res) {\n        var json = res.data.data[0];\n\n        if (json.length > 0) {\n          _this6.classesOptions = json;\n        }\n      });\n    },\n    // 显示删除学生 Dialog\n    showDeleteModal: function showDeleteModal(index, row) {\n      this.deleteStudentId = row.id;\n      this.deleteStudentDialog = true;\n    },\n    // 删除学生信息\n    deleteStudent: function deleteStudent() {\n      var _this7 = this;\n\n      this.$axios.post(this.$global.sApi + '/addstuinfo', JSON.stringify({\n        'stuinfoid': parseInt(this.deleteStudentId),\n        type: 3\n      })).then(function (res) {\n        _this7.$message({\n          message: '删除成功',\n          type: 'success'\n        });\n\n        _this7.deleteStudentDialog = false;\n\n        _this7.requestStudentInfoJsonData();\n      });\n    },\n    // 专业选择\n    majorSelect: function majorSelect() {\n      this.requestFilterJsonData();\n      this.requestClassesJsonData();\n    },\n    // 班级选择\n    classesSelect: function classesSelect() {\n      this.requestFilterJsonData();\n    },\n    // 表单专业选择\n    formMajorSelect: function formMajorSelect() {},\n    // 表单班级选择\n    formClassesSelect: function formClassesSelect(e) {\n      console.log(e);\n    },\n    // 院校专业菜单\n    handleNodeClick: function handleNodeClick(data) {\n      if ((0, _typeof2.default)(data.classinfo) === \"object\") {\n        this.clickMajor = data.id;\n      } else {\n        this.clickClasses = data.id;\n      }\n\n      this.requestFilterClickJsonData();\n    },\n    // 树形菜单\n    renderContent: function renderContent(h, _ref) {\n      var node = _ref.node,\n          data = _ref.data,\n          store = _ref.store;\n      var addElement = arguments[0];\n      return addElement('span', {\n        class: \"folder-box\"\n      }, [addElement('i', {\n        class: \"folder-icon\"\n      }), addElement('span', \"    \"), addElement('span', arguments[1].node.label)]);\n    },\n    // 下载模板\n    downloadModal: function downloadModal() {\n      var _this8 = this;\n\n      // 加载loading\n      this.loading = true;\n      this.$axios.get(this.$global.sApi + '/article/批量导入模板.xlsx').then(function (res) {\n        // 关闭loading\n        _this8.loading = false;\n        var content = res.data;\n        var blob = new Blob([content]);\n        var fileName = '学生资料模板.xls';\n\n        if ('download' in document.createElement('a')) {\n          var link = document.createElement('a');\n          link.download = fileName;\n          link.style.display = 'none';\n          link.href = URL.createObjectURL(blob);\n          document.body.appendChild(link);\n          link.click();\n          URL.revokeObjectURL(link.href);\n          document.body.removeChild(link);\n        } else {\n          navigator.msSaveBlob(blob, fileName);\n        }\n      }).catch(function (error) {\n        console.log(error); // 关闭loading\n\n        _this8.loading = false;\n      });\n    },\n    // 文件选择\n    handleChange: function handleChange(file, fileList) {\n      this.fileList = fileList.slice(-3);\n    },\n    // 前端校验文件上传是否符合条件\n    file_info_check: function file_info_check(file) {\n      var ret = \"\";\n\n      if (file === undefined) {\n        ret = \"\";\n      }\n\n      var max_file_size = 2 * 1024 * 1024;\n\n      if (file.size > max_file_size) {\n        ret = \"文件不能大于2Mb\";\n      }\n\n      var allow_type = \".xlsx\";\n      var allow_type2 = \".xls\";\n\n      if (file.name.indexOf(allow_type) === -1) {\n        ret = \"文件格式要求是.xls/.xlsx\";\n      } else {\n        ret = 'success';\n        return ret;\n      }\n\n      if (file.name.indexOf(allow_type2) === -1) {\n        ret = \"文件格式要求是.xls/.xlsx\";\n      } else {\n        ret = 'success';\n        return ret;\n      }\n\n      this.loading = false;\n      return ret;\n    },\n    uploadImg: function uploadImg(fileObj) {\n      var _this9 = this;\n\n      this.loading = true;\n      var fileStatus = this.file_info_check(fileObj.file);\n\n      if (fileStatus === 'success') {\n        var formData = new FormData();\n        formData.append(\"file\", fileObj.file);\n        formData.append(\"scinfoid\", this.schoolId);\n        this.$axios.post(this.$global.sApi + '/exclein', formData, {\n          headers: {\n            \"Content-type\": \"multipart/form-data\"\n          }\n        }).then(function (res) {\n          _this9.$message({\n            message: '提交成功',\n            type: 'success'\n          });\n\n          _this9.loading = false;\n        });\n      } else {\n        this.$message({\n          message: fileStatus,\n          type: 'error'\n        });\n        this.loading = false;\n      }\n    },\n    // 提交\n    submitForm: function submitForm(formName) {\n      var _this10 = this;\n\n      this.$refs[formName].validate(function (valid) {\n        if (valid) {\n          if (_this10.insertOrModifyModel === 0) {\n            _this10.insertStudentInfoApi(formName);\n          } else {\n            _this10.modifyStudentInfoApi(formName);\n          }\n        } else {\n          return false;\n        }\n      });\n    },\n    // 添加学生资料\n    insertStudentInfoApi: function insertStudentInfoApi(formName) {\n      var _this11 = this;\n\n      this.$axios.post(this.$global.sApi + '/addstuinfo', JSON.stringify({\n        'username': this.studentInfoForm.name,\n        'age': (0, _formatDate.formatDate)(this.studentInfoForm.birthday, 'yyyy年MM月dd日'),\n        'live': this.studentInfoForm.grade,\n        'classname': this.studentInfoForm.classes.proname,\n        'classinfoid': parseInt(this.studentInfoForm.classes.id),\n        'scinfoid': this.schoolId,\n        'phone': this.studentInfoForm.photo,\n        'type': 1\n      })).then(function (res) {\n        _this11.insertSingleStudentInfoDialog = false;\n\n        _this11.$refs[formName].resetFields();\n\n        _this11.$message({\n          message: '添加成功',\n          type: 'success'\n        });\n\n        _this11.requestStudentInfoJsonData();\n      });\n    },\n    // 编辑学生资料\n    modifyStudentInfoApi: function modifyStudentInfoApi() {\n      var _this12 = this;\n\n      this.$axios.post(this.$global.sApi + '/addstuinfo', JSON.stringify({\n        'stuinfoid': parseInt(this.studentInfoForm.id),\n        'username': this.studentInfoForm.name,\n        'age': (0, _formatDate.formatDate)(this.studentInfoForm.birthday, 'yyyy年MM月dd日'),\n        'live': this.studentInfoForm.grade,\n        'classname': this.studentInfoForm.classes.proname,\n        'classinfoid': parseInt(this.studentInfoForm.classes.id),\n        'phone': this.studentInfoForm.photo,\n        'scinfoid': this.schoolId,\n        'type': 2\n      })).then(function (res) {\n        console.log(res);\n        _this12.insertSingleStudentInfoDialog = false;\n        _this12.studentInfoForm = {};\n\n        _this12.$refs[formName].resetFields();\n\n        _this12.$message({\n          message: '编辑成功',\n          type: 'success'\n        });\n\n        _this12.requestStudentInfoJsonData();\n      });\n    }\n  }\n};\nexports.default = _default;",null]}